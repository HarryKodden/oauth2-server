time="2025-07-22T00:19:31+02:00" level=info msg="🚀 Starting OAuth2 Server..."
{"level":"info","msg":"✅ Configuration loaded successfully","time":"2025-07-22T00:19:31+02:00"}
{"level":"info","msg":"🔧 Log Level: debug, Format: json, Audit: true","time":"2025-07-22T00:19:31+02:00"}
2025/07/22 00:19:31 ✅ Loaded client from config: frontend-app (Frontend Application)
2025/07/22 00:19:31 ✅ Loaded client from config: backend-client (Backend Service)
2025/07/22 00:19:31 ✅ Loaded client from config: frontend-client (Frontend Client Application)
2025/07/22 00:19:31 ✅ Loaded client from config: mobile-app (Mobile Application)
2025/07/22 00:19:31 ✅ Loaded client from config: smart-tv-app (Smart TV Application)
2025/07/22 00:19:31 📦 Loaded 5 clients from configuration
2025/07/22 00:19:32 🗑️ Device code cleanup timer started
{"level":"info","msg":"✅ OAuth2 flows initialized","time":"2025-07-22T00:19:32+02:00"}
{"level":"info","msg":"🔧 Debug endpoints enabled at /debug/*","time":"2025-07-22T00:19:32+02:00"}
{"level":"info","msg":"🌐 OAuth2 server starting on port 8080","time":"2025-07-22T00:19:32+02:00"}
{"level":"info","msg":"🔗 Authorization endpoint: http://localhost:8080/auth","time":"2025-07-22T00:19:32+02:00"}
{"level":"info","msg":"🎫 Token endpoint: http://localhost:8080/token","time":"2025-07-22T00:19:32+02:00"}
{"level":"info","msg":"📱 Device authorization: http://localhost:8080/device_authorization","time":"2025-07-22T00:19:32+02:00"}
{"level":"info","msg":"🔧 Client registration: http://localhost:8080/register","time":"2025-07-22T00:19:32+02:00"}
{"level":"info","msg":"🏥 Health check: http://localhost:8080/health","time":"2025-07-22T00:19:32+02:00"}
{"level":"info","msg":"🔄 Proxy-aware request: POST /device_authorization (Original: ://localhost:8080, Forwarded: ://localhost:8080)","time":"2025-07-22T00:19:39+02:00"}
2025/07/22 00:19:39 🎯 Processing device authorization request
2025/07/22 00:19:39 ✅ Device authorization created for client: frontend-client, user code: TVAB-6YAQ
2025/07/22 00:19:39 📱 Verification URI: http://localhost:8080/device
2025/07/22 00:19:39 🔗 Complete URI: http://localhost:8080/device?user_code=TVAB-6YAQ
{"level":"info","msg":"🔄 Proxy-aware request: POST /device (Original: ://localhost:8080, Forwarded: ://localhost:8080)","time":"2025-07-22T00:19:39+02:00"}
2025/07/22 00:19:39 ✅ Device authorized: code=TVAB-6YAQ, user=user-001
{"level":"info","msg":"🔄 Proxy-aware request: GET /health (Original: ://localhost:8080, Forwarded: ://localhost:8080)","time":"2025-07-22T00:19:47+02:00"}
{"level":"info","msg":"🔄 Proxy-aware request: GET /health (Original: ://localhost:8080, Forwarded: ://localhost:8080)","time":"2025-07-22T00:19:55+02:00"}
{"level":"info","msg":"🔄 Proxy-aware request: GET / (Original: ://localhost:8080, Forwarded: ://localhost:8080)","time":"2025-07-22T00:20:05+02:00"}
{"level":"info","msg":"🔄 Proxy-aware request: GET /auth?client_id=frontend-app\u0026redirect_uri=http%3A//localhost%3A8080/callback\u0026response_type=code\u0026scope=openid%20profile%20email%20api%3Aread\u0026state=test123 (Original: ://localhost:8080, Forwarded: ://localhost:8080)","time":"2025-07-22T00:20:05+02:00"}
2025/07/22 00:20:05 🔄 Authorization request: GET /auth?client_id=frontend-app&redirect_uri=http%3A//localhost%3A8080/callback&response_type=code&scope=openid%20profile%20email%20api%3Aread&state=test123
2025/07/22 00:20:05 🔍 Query parameters: map[client_id:[frontend-app] redirect_uri:[http://localhost:8080/callback] response_type:[code] scope:[openid profile email api:read] state:[test123]]
2025/07/22 00:20:05 ❌ Error creating authorization request: invalid_state
{"level":"info","msg":"🔄 Proxy-aware request: POST /token (Original: ://localhost:8080, Forwarded: ://localhost:8080)","time":"2025-07-22T00:20:05+02:00"}
{"level":"info","msg":"🔄 Processing token request with grant_type: client_credentials","time":"2025-07-22T00:20:05+02:00"}
2025/07/22 00:20:05 ✅ Refresh token issued for client credentials flow: backend-client
2025/07/22 00:20:05 ✅ Client credentials token issued for client: backend-client
{"level":"info","msg":"🔄 Proxy-aware request: POST /token (Original: ://localhost:8080, Forwarded: ://localhost:8080)","time":"2025-07-22T00:20:05+02:00"}
{"level":"info","msg":"🔄 Processing token request with grant_type: refresh_token","time":"2025-07-22T00:20:05+02:00"}
2025/07/22 00:20:05 🔄 Processing token refresh request
2025/07/22 00:20:05 ✅ Tokens refreshed for client: backend-client
{"level":"info","msg":"🔄 Proxy-aware request: POST /device_authorization (Original: ://localhost:8080, Forwarded: ://localhost:8080)","time":"2025-07-22T00:20:05+02:00"}
2025/07/22 00:20:05 🎯 Processing device authorization request
2025/07/22 00:20:05 ✅ Device authorization created for client: frontend-client, user code: 6NXF-4DCU
2025/07/22 00:20:05 📱 Verification URI: http://localhost:8080/device
2025/07/22 00:20:05 🔗 Complete URI: http://localhost:8080/device?user_code=6NXF-4DCU
{"level":"info","msg":"🔄 Proxy-aware request: POST /device (Original: ://localhost:8080, Forwarded: ://localhost:8080)","time":"2025-07-22T00:20:06+02:00"}
2025/07/22 00:20:06 ✅ Device authorized: code=6NXF-4DCU, user=user-001
{"level":"info","msg":"🔄 Proxy-aware request: POST /token (Original: ://localhost:8080, Forwarded: ://localhost:8080)","time":"2025-07-22T00:20:06+02:00"}
{"level":"info","msg":"🔄 Processing token request with grant_type: urn:ietf:params:oauth:grant-type:device_code","time":"2025-07-22T00:20:06+02:00"}
2025/07/22 00:20:06 🎯 Processing device token request
2025/07/22 00:20:06 ✅ Access token issued for device: GI2cQVXtR0ZDyjSpSiSujJuFOVz0bMpS, user: user-001
{"level":"info","msg":"🔄 Proxy-aware request: GET /userinfo (Original: ://localhost:8080, Forwarded: ://localhost:8080)","time":"2025-07-22T00:20:06+02:00"}
{"level":"info","msg":"🔄 Proxy-aware request: POST /token (Original: ://localhost:8080, Forwarded: ://localhost:8080)","time":"2025-07-22T00:20:06+02:00"}
{"level":"info","msg":"🔄 Processing token request with grant_type: urn:ietf:params:oauth:grant-type:token-exchange","time":"2025-07-22T00:20:06+02:00"}
2025/07/22 00:20:06 ✅ Token exchange completed for client: backend-client, user: 
{"level":"info","msg":"🔄 Proxy-aware request: GET /userinfo (Original: ://localhost:8080, Forwarded: ://localhost:8080)","time":"2025-07-22T00:20:06+02:00"}
{"level":"info","msg":"🔄 Proxy-aware request: GET /.well-known/openid_configuration (Original: ://localhost:8080, Forwarded: ://localhost:8080)","time":"2025-07-22T00:20:06+02:00"}
{"level":"info","msg":"🔄 Proxy-aware request: GET /device (Original: ://localhost:8080, Forwarded: ://localhost:8080)","time":"2025-07-22T00:22:00+02:00"}
{"level":"info","msg":"🔄 Proxy-aware request: GET /favicon.ico (Original: ://localhost:8080, Forwarded: ://localhost:8080)","time":"2025-07-22T00:22:01+02:00"}
{"level":"info","msg":"🔄 Proxy-aware request: GET / (Original: ://localhost:8080, Forwarded: ://localhost:8080)","time":"2025-07-22T00:22:04+02:00"}
{"level":"info","msg":"🔄 Proxy-aware request: GET /favicon.ico (Original: ://localhost:8080, Forwarded: ://localhost:8080)","time":"2025-07-22T00:22:04+02:00"}
{"level":"info","msg":"🔄 Proxy-aware request: GET /client1/auth (Original: ://localhost:8080, Forwarded: ://localhost:8080)","time":"2025-07-22T00:22:07+02:00"}
{"level":"info","msg":"🔄 Proxy-aware request: GET /auth?client_id=frontend-app\u0026redirect_uri=http://localhost:8080/client1/callback\u0026response_type=code\u0026scope=openid+profile+email\u0026state=random-state (Original: ://localhost:8080, Forwarded: ://localhost:8080)","time":"2025-07-22T00:22:07+02:00"}
2025/07/22 00:22:07 🔄 Authorization request: GET /auth?client_id=frontend-app&redirect_uri=http://localhost:8080/client1/callback&response_type=code&scope=openid+profile+email&state=random-state
2025/07/22 00:22:07 🔍 Query parameters: map[client_id:[frontend-app] redirect_uri:[http://localhost:8080/client1/callback] response_type:[code] scope:[openid profile email] state:[random-state]]
2025/07/22 00:22:07 ✅ Authorization request created successfully for client: frontend-app
{"level":"info","msg":"🔄 Proxy-aware request: GET /favicon.ico (Original: ://localhost:8080, Forwarded: ://localhost:8080)","time":"2025-07-22T00:22:07+02:00"}
{"level":"info","msg":"🔄 Proxy-aware request: GET /favicon.ico (Original: ://localhost:8080, Forwarded: ://localhost:8080)","time":"2025-07-22T00:22:17+02:00"}
{"level":"info","msg":"🔄 Proxy-aware request: GET / (Original: ://localhost:8080, Forwarded: ://localhost:8080)","time":"2025-07-22T00:22:19+02:00"}
{"level":"info","msg":"🔄 Proxy-aware request: GET /favicon.ico (Original: ://localhost:8080, Forwarded: ://localhost:8080)","time":"2025-07-22T00:22:19+02:00"}
{"level":"info","msg":"🔄 Proxy-aware request: GET /client1/auth (Original: ://localhost:8080, Forwarded: ://localhost:8080)","time":"2025-07-22T00:22:21+02:00"}
{"level":"info","msg":"🔄 Proxy-aware request: GET /auth?client_id=frontend-app\u0026redirect_uri=http://localhost:8080/client1/callback\u0026response_type=code\u0026scope=openid+profile+email\u0026state=random-state (Original: ://localhost:8080, Forwarded: ://localhost:8080)","time":"2025-07-22T00:22:21+02:00"}
2025/07/22 00:22:21 🔄 Authorization request: GET /auth?client_id=frontend-app&redirect_uri=http://localhost:8080/client1/callback&response_type=code&scope=openid+profile+email&state=random-state
2025/07/22 00:22:21 🔍 Query parameters: map[client_id:[frontend-app] redirect_uri:[http://localhost:8080/client1/callback] response_type:[code] scope:[openid profile email] state:[random-state]]
2025/07/22 00:22:21 ✅ Authorization request created successfully for client: frontend-app
{"level":"info","msg":"🔄 Proxy-aware request: GET /favicon.ico (Original: ://localhost:8080, Forwarded: ://localhost:8080)","time":"2025-07-22T00:22:21+02:00"}
{"level":"info","msg":"🔄 Proxy-aware request: GET /favicon.ico (Original: ://localhost:8080, Forwarded: ://localhost:8080)","time":"2025-07-22T00:22:36+02:00"}
